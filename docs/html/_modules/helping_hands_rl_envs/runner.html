
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>helping_hands_rl_envs.runner &#8212; HelpingHandsEnvs 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">HelpingHandsEnvs 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">helping_hands_rl_envs.runner</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for helping_hands_rl_envs.runner</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">.. moduleauthor: Colin Kohler &lt;github.com/ColinKohler&gt;</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Pipe</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">git</span>
<span class="kn">import</span> <span class="nn">helping_hands_rl_envs</span>

<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">remote</span><span class="p">,</span> <span class="n">parent_remote</span><span class="p">,</span> <span class="n">env_fn</span><span class="p">,</span> <span class="n">planner_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Worker function which interacts with the environment over the remove connection</span>

<span class="sd">  Args:</span>
<span class="sd">    remote (multiprocessing.Connection): Worker remote connection</span>
<span class="sd">    parent_remote (multiprocessing.Connection): MultiRunner remote connection</span>
<span class="sd">    env_fn (function): Creates a environment</span>
<span class="sd">    planner_fn (function): Creates the planner for the environment</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">parent_remote</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

  <span class="n">env</span> <span class="o">=</span> <span class="n">env_fn</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">planner_fn</span><span class="p">:</span>
    <span class="n">planner</span> <span class="o">=</span> <span class="n">planner_fn</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">planner</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">cmd</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;simulate&#39;</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;can_simulate&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">canSimulate</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;reset_sim&#39;</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">resetSimPose</span><span class="p">()</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;step_auto_reset&#39;</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
          <span class="c1"># get observation after reset (res index 0), the rest stays the same</span>
          <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(),</span> <span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;reset&#39;</span><span class="p">:</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_obs&#39;</span><span class="p">:</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">_getObservation</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">last_action</span><span class="p">)</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_spaces&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="n">env</span><span class="o">.</span><span class="n">obs_shape</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">action_shape</span><span class="p">))</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_object_positions&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">getObjectPositions</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_object_poses&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">getObjectPoses</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;set_pos_candidate&#39;</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">setPosCandidate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;did_block_fall&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">didBlockFall</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;are_objects_in_workspace&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">areObjectsInWorkspace</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;is_sim_valid&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">isSimValid</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_value&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">planner</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_step_left&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">planner</span><span class="o">.</span><span class="n">getStepLeft</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_active_env_id&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">active_env_id</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_empty_in_hand&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">getEmptyInHand</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_env_id&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">active_env_id</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_next_action&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">planner</span><span class="p">:</span>
          <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">planner</span><span class="o">.</span><span class="n">getNextAction</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_random_action&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">planner</span><span class="p">:</span>
          <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">planner</span><span class="o">.</span><span class="n">getRandomAction</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_value&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">planner</span><span class="p">:</span>
          <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">planner</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;get_steps_left&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">planner</span><span class="p">:</span>
          <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">planner</span><span class="o">.</span><span class="n">getStepsLeft</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;save&#39;</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">saveState</span><span class="p">()</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;restore&#39;</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">restoreState</span><span class="p">()</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;save_to_file&#39;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">env</span><span class="o">.</span><span class="n">saveEnvToFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;load_from_file&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">path</span> <span class="o">=</span> <span class="n">data</span>
          <span class="n">env</span><span class="o">.</span><span class="n">loadEnvFromFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MultiRunner worker load failed: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
          <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotImplementerError</span>
  <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MultiRunner worker: caught keyboard interrupt&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="MultiRunner"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner">[docs]</a><span class="k">class</span> <span class="nc">MultiRunner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Runner which runs mulitple environemnts in parallel in subprocesses and communicates with them via pipe.</span>

<span class="sd">  Args:</span>
<span class="sd">    env_fns (list[function]): Env creation functions</span>
<span class="sd">    planner_fns (list[function]): Planner creation functions</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_fns</span><span class="p">,</span> <span class="n">planner_fns</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">waiting</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">num_envs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">env_fns</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker_remotes</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">Pipe</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_envs</span><span class="p">)])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processes</span> <span class="o">=</span> <span class="p">[</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">worker_remote</span><span class="p">,</span> <span class="n">remote</span><span class="p">,</span> <span class="n">env_fn</span><span class="p">,</span> <span class="n">planner_fn</span><span class="p">))</span>
                      <span class="k">for</span> <span class="p">(</span><span class="n">worker_remote</span><span class="p">,</span> <span class="n">remote</span><span class="p">,</span> <span class="n">env_fn</span><span class="p">,</span> <span class="n">planner_fn</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">worker_remotes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">,</span> <span class="n">env_fns</span><span class="p">,</span> <span class="n">planner_fns</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_processes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">:</span>
      <span class="n">process</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker_remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="MultiRunner.step"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.step">[docs]</a>  <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">auto_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Step the environments synchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">      actions (numpy.array): Actions to take in each environment</span>
<span class="sd">      auto_reset (bool): Reset environments automatically after an episode ends</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.array, numpy.array, numpy.array): (observations, rewards, done flags)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stepAsync</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">auto_reset</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepWait</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">remote</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;simulate&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">))</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">obs</span><span class="p">)</span>

    <span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">states</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">hand_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">hand_obs</span><span class="p">)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">rewards</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">states</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">dones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">states</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">),</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span>

  <span class="k">def</span> <span class="nf">canSimulate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;can_simulate&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flag</span>

  <span class="k">def</span> <span class="nf">resetSimPose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;reset_sim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

<div class="viewcode-block" id="MultiRunner.stepAsync"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.stepAsync">[docs]</a>  <span class="k">def</span> <span class="nf">stepAsync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">auto_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Step each environment in a async fashion.</span>

<span class="sd">    Args:</span>
<span class="sd">      actions (numpy.array): Actions to take in each environment</span>
<span class="sd">      auto_reset (bool): Reset environments automatically after an episode ends</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">auto_reset</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;step_auto_reset&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">waiting</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MultiRunner.stepWait"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.stepWait">[docs]</a>  <span class="k">def</span> <span class="nf">stepWait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Wait until each environment has completed its next step.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.array, numpy.array, numpy.array): (observations, rewards, done flags)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">waiting</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">res</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">results</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span> <span class="o">=</span> <span class="n">res</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">res</span>

    <span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">obs</span><span class="p">)</span>

    <span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">states</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">hand_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">hand_obs</span><span class="p">)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">rewards</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span>
    <span class="n">dones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dones</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">),</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">metadata</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">),</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span></div>

<div class="viewcode-block" id="MultiRunner.reset"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.reset">[docs]</a>  <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reset each environment.</span>

<span class="sd">    Returns:</span>
<span class="sd">      numpy.array: Observations</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">obs</span><span class="p">)</span>

    <span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">states</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">hand_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">hand_obs</span><span class="p">)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiRunner.reset_envs"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.reset_envs">[docs]</a>  <span class="k">def</span> <span class="nf">reset_envs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_nums</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Resets the specified environments.</span>

<span class="sd">    Args:</span>
<span class="sd">      env_nums (list[int]): The environments to be reset</span>

<span class="sd">    Returns:</span>
<span class="sd">      numpy.array: Observations</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">env_num</span> <span class="ow">in</span> <span class="n">env_nums</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">[</span><span class="n">env_num</span><span class="p">]</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">[</span><span class="n">env_num</span><span class="p">]</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">env_num</span> <span class="ow">in</span> <span class="n">env_nums</span><span class="p">]</span>
    <span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">obs</span><span class="p">)</span>

    <span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">states</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">hand_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">hand_obs</span><span class="p">)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiRunner.getActiveEnvId"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getActiveEnvId">[docs]</a>  <span class="k">def</span> <span class="nf">getActiveEnvId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_active_env_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">active_env_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">active_env_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">active_env_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">active_env_id</span></div>

<div class="viewcode-block" id="MultiRunner.close"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.close">[docs]</a>  <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Close all worker processes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">waiting</span><span class="p">:</span>
      <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="p">[</span><span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processes</span><span class="p">]</span></div>

<div class="viewcode-block" id="MultiRunner.save"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.save">[docs]</a>  <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Locally saves the current state of the environments.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span></div>

<div class="viewcode-block" id="MultiRunner.restore"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.restore">[docs]</a>  <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Restores the locally saved state of the environments.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;restore&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span></div>

<div class="viewcode-block" id="MultiRunner.saveToFile"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.saveToFile">[docs]</a>  <span class="k">def</span> <span class="nf">saveToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Saves the current state of the environments to file.</span>

<span class="sd">    Args:</span>
<span class="sd">      path (str): The path to save the enviornment states to</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">remote</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">):</span>
      <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;save_to_file&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))))</span></div>

<div class="viewcode-block" id="MultiRunner.loadFromFile"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.loadFromFile">[docs]</a>  <span class="k">def</span> <span class="nf">loadFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Loads the state of the environments from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      path (str): The path to the environment states to load</span>

<span class="sd">    Returns:</span>
<span class="sd">      bool: Flag indicating if the loading succeeded for all environments</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">remote</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">):</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;load_from_file&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiRunner.getObjectPositions"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getObjectPositions">[docs]</a>  <span class="k">def</span> <span class="nf">getObjectPositions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_object_positions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiRunner.getObjectPoses"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getObjectPoses">[docs]</a>  <span class="k">def</span> <span class="nf">getObjectPoses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_object_poses&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="n">poses</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poses</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiRunner.getNextAction"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getNextAction">[docs]</a>  <span class="k">def</span> <span class="nf">getNextAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the next action from the planner for each environment.</span>

<span class="sd">    Returns:</span>
<span class="sd">      numpy.array: Actions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_next_action&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">action</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action</span></div>

<div class="viewcode-block" id="MultiRunner.getRandomAction"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getRandomAction">[docs]</a>  <span class="k">def</span> <span class="nf">getRandomAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get a random action for each environment.</span>

<span class="sd">    Returns:</span>
<span class="sd">      numpy.array: Actions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_random_action&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">action</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action</span></div>

<div class="viewcode-block" id="MultiRunner.getValue"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getValue">[docs]</a>  <span class="k">def</span> <span class="nf">getValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="MultiRunner.getStepsLeft"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getStepsLeft">[docs]</a>  <span class="k">def</span> <span class="nf">getStepsLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_steps_left&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="MultiRunner.getObs"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getObs">[docs]</a>  <span class="k">def</span> <span class="nf">getObs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the current observation for the environments.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.array, numpy.array, numpy.array): (hand state, in-hand observation, workspace observation)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_obs&#39;</span><span class="p">))</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">obs</span><span class="p">)</span>

    <span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">states</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">hand_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">hand_obs</span><span class="p">)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span></div>

<div class="viewcode-block" id="MultiRunner.areObjectsInWorkspace"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.areObjectsInWorkspace">[docs]</a>  <span class="k">def</span> <span class="nf">areObjectsInWorkspace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;are_objects_in_workspace&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">in_workspace</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">in_workspace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">in_workspace</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">in_workspace</span></div>

<div class="viewcode-block" id="MultiRunner.isSimValid"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.isSimValid">[docs]</a>  <span class="k">def</span> <span class="nf">isSimValid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;is_sim_valid&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valid</span></div>

<div class="viewcode-block" id="MultiRunner.didBlockFall"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.didBlockFall">[docs]</a>  <span class="k">def</span> <span class="nf">didBlockFall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;did_block_fall&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">did_block_fall</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">did_block_fall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">did_block_fall</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">did_block_fall</span></div>

<div class="viewcode-block" id="MultiRunner.setPosCandidate"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.setPosCandidate">[docs]</a>  <span class="k">def</span> <span class="nf">setPosCandidate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_candidate</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;set_pos_candidate&#39;</span><span class="p">,</span> <span class="n">pos_candidate</span><span class="p">))</span></div>

<div class="viewcode-block" id="MultiRunner.getEmptyInHand"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getEmptyInHand">[docs]</a>  <span class="k">def</span> <span class="nf">getEmptyInHand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">:</span>
      <span class="n">remote</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s1">&#39;get_empty_in_hand&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">hand_obs</span> <span class="o">=</span> <span class="p">[</span><span class="n">remote</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span> <span class="k">for</span> <span class="n">remote</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">remotes</span><span class="p">]</span>
    <span class="n">hand_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">hand_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hand_obs</span></div>

<div class="viewcode-block" id="MultiRunner.getEnvGitHash"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.MultiRunner.getEnvGitHash">[docs]</a>  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">getEnvGitHash</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">helping_hands_rl_envs</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">hexsha</span></div></div>

<div class="viewcode-block" id="SingleRunner"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner">[docs]</a><span class="k">class</span> <span class="nc">SingleRunner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  RL environment runner which runs a single environment.</span>

<span class="sd">  Args:</span>
<span class="sd">    env (BaseEnv): Environment</span>
<span class="sd">    planner (BasePlanner): Planner</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">planner</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">planner</span> <span class="o">=</span> <span class="n">planner</span>

<div class="viewcode-block" id="SingleRunner.step"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.step">[docs]</a>  <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">auto_reset</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Step the environment.</span>

<span class="sd">    Args:</span>
<span class="sd">      action (numpy.array): Action to take in the environment</span>
<span class="sd">      auto_reset (bool): Reset the environment after an episode ends</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.array, numpy.array, numpy.array): (observations, rewards, done flags)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span> <span class="o">=</span> <span class="n">results</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">results</span>
    <span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span>

    <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">),</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">metadata</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">hand_obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">),</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span></div>

<div class="viewcode-block" id="SingleRunner.reset"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.reset">[docs]</a>  <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reset the environment.</span>

<span class="sd">    Returns:</span>
<span class="sd">      numpy.array: Observation</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>

<div class="viewcode-block" id="SingleRunner.save"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.save">[docs]</a>  <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Locally saves the current state of the environment.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>

<div class="viewcode-block" id="SingleRunner.restore"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.restore">[docs]</a>  <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Restores the locally saved state of the environment.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span></div>

<div class="viewcode-block" id="SingleRunner.saveToFile"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.saveToFile">[docs]</a>  <span class="k">def</span> <span class="nf">saveToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Saves the current state of the environment to file.</span>

<span class="sd">    Args:</span>
<span class="sd">      path (str): The path to save the enviornment state to</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">saveToFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.loadFromFile"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.loadFromFile">[docs]</a>  <span class="k">def</span> <span class="nf">loadFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Loads the state of the environment from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      path (str): The path to the environment state to load</span>

<span class="sd">    Returns:</span>
<span class="sd">      bool: Flag indicating if the loading succeeded</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">loadFromFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.getObjectPositions"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getObjectPositions">[docs]</a>  <span class="k">def</span> <span class="nf">getObjectPositions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">getObjectPositions</span><span class="p">()</span></div>

<div class="viewcode-block" id="SingleRunner.getObjectPoses"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getObjectPoses">[docs]</a>  <span class="k">def</span> <span class="nf">getObjectPoses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">getObjectPoses</span><span class="p">()</span></div>

<div class="viewcode-block" id="SingleRunner.getNextAction"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getNextAction">[docs]</a>  <span class="k">def</span> <span class="nf">getNextAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="o">.</span><span class="n">getNextAction</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.getRandomAction"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getRandomAction">[docs]</a>  <span class="k">def</span> <span class="nf">getRandomAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="o">.</span><span class="n">getRandomAction</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.getValue"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getValue">[docs]</a>  <span class="k">def</span> <span class="nf">getValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.getStepsLeft"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getStepsLeft">[docs]</a>  <span class="k">def</span> <span class="nf">getStepsLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="o">.</span><span class="n">getStepsLeft</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.getActiveEnvId"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getActiveEnvId">[docs]</a>  <span class="k">def</span> <span class="nf">getActiveEnvId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">active_env_id</span></div>

<div class="viewcode-block" id="SingleRunner.areObjectsInWorkspace"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.areObjectsInWorkspace">[docs]</a>  <span class="k">def</span> <span class="nf">areObjectsInWorkspace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">planner</span><span class="o">.</span><span class="n">areObjectsInWorkspace</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Attempting to use a planner which was not initialized.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.isSimValid"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.isSimValid">[docs]</a>  <span class="k">def</span> <span class="nf">isSimValid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">isSimValid</span><span class="p">()</span></div>


<div class="viewcode-block" id="SingleRunner.getObs"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getObs">[docs]</a>  <span class="k">def</span> <span class="nf">getObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_getObservation</span><span class="p">(</span><span class="n">action</span> <span class="k">if</span> <span class="n">action</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">last_action</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.didBlockFall"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.didBlockFall">[docs]</a>  <span class="k">def</span> <span class="nf">didBlockFall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">didBlockFall</span><span class="p">()</span></div>

<div class="viewcode-block" id="SingleRunner.setPosCandidate"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.setPosCandidate">[docs]</a>  <span class="k">def</span> <span class="nf">setPosCandidate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_candidate</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">setPosCandidate</span><span class="p">(</span><span class="n">pos_candidate</span><span class="p">)</span></div>

<div class="viewcode-block" id="SingleRunner.getEmptyInHand"><a class="viewcode-back" href="../../index.html#helping_hands_rl_envs.runner.SingleRunner.getEmptyInHand">[docs]</a>  <span class="k">def</span> <span class="nf">getEmptyInHand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">getEmptyInHand</span><span class="p">()</span></div>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">getEnvGitHash</span><span class="p">():</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">helping_hands_rl_envs</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">hexsha</span>

  <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">HelpingHandsEnvs 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">helping_hands_rl_envs.runner</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Colin Kohler, Dian Wang.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>